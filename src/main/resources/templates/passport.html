<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: head"></head>
<body>

<div class="form-container height-100">
    <div class="container">
        <div class="card my-5">

            <!-- Spinner должен появляться в момент отправки запроса на выпуск карты, т.е. после скана паспорта //-->
            <div class="spinner-container" id="spinner">
                <span class="spinner-title" id="spinner-title">Распознавание паспорта...</span>
                <div class="d-flex justify-content-center">
                    <div class="spinner-border" role="status"></div>
                </div>
            </div>
            <!--//-->

            <form class="check-passport" action="check-passport" method="post" enctype="multipart/form-data" id="form">

                <input readonly name="redirectUrl" type="text" hidden="hidden" th:value="${redirectUrl}"/>
                <input readonly name="startUrl"    type="text" hidden="hidden" th:value="${startUrl}"/>
                <input readonly name="issue_date"  type="text" hidden="hidden" th:value="${issue_date}"/>
                <input readonly name="passportId"  type="text" hidden="hidden" th:value="${passportId}"/>

                <th:block th:if="${errorMessage}">
                    <input readonly name="runetId"     type="text" hidden="hidden" th:value="${runetId}"/>
                    <input readonly name="name"        type="text" hidden="hidden" th:value="${name}"/>
                    <input readonly name="surname"     type="text" hidden="hidden" th:value="${surname}"/>
                    <input readonly name="patronymic"  type="text" hidden="hidden" th:value="${patronymic}"/>
                    <input readonly name="birthdate"   type="text" hidden="hidden" th:value="${birthdate}"/>
                    <input readonly name="phoneNumber" type="text" hidden="hidden" th:value="${phoneNumber}"/>
                    <input readonly name="codeword"    type="text" hidden="hidden" th:value="${codeword}"/>
                </th:block>

                <div th:if="!${errorMessage} and !${okMessage}" id="formDataId">
                    <div class="runet-id" th:text="'RUNET-ID ' + ${runetId}"></div>
                    <div class="form-row justify-content-between">
                        <div class="col-md col-12 max-width">
                            <div class="md-form form-group">
                                <label for="phoneNumber">Телефон</label>
                                <input required id="phoneNumber" class="form-control" type="text" name="phoneNumber" th:value="${phoneNumber}"/>
                                <div class="tooltip-info" data-toggle="tooltip" data-placement="bottom" title="Этот номер будет использоваться для подтверждения операций по карте">
                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M13.07 9.25L12.17 10.17C11.45 10.89 11 11.5 11 13H9V12.5C9 11.39 9.45 10.39 10.17 9.67L11.41 8.41C11.78 8.05 12 7.55 12 7C12 5.89 11.1 5 10 5C9.46957 5 8.96086 5.21071 8.58579 5.58579C8.21071 5.96086 8 6.46957 8 7H6C6 5.93913 6.42143 4.92172 7.17157 4.17157C7.92172 3.42143 8.93913 3 10 3C11.0609 3 12.0783 3.42143 12.8284 4.17157C13.5786 4.92172 14 5.93913 14 7C14 7.88 13.64 8.67 13.07 9.25ZM11 17H9V15H11V17ZM10 0C8.68678 0 7.38642 0.258658 6.17317 0.761205C4.95991 1.26375 3.85752 2.00035 2.92893 2.92893C1.05357 4.8043 0 7.34784 0 10C0 12.6522 1.05357 15.1957 2.92893 17.0711C3.85752 17.9997 4.95991 18.7362 6.17317 19.2388C7.38642 19.7413 8.68678 20 10 20C12.6522 20 15.1957 18.9464 17.0711 17.0711C18.9464 15.1957 20 12.6522 20 10C20 4.47 15.5 0 10 0Z" fill="#7775D9"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        <div class="col-md col-12 max-width">
                            <div class="md-form form-group">
                                <label for="codeword">Кодовое слово</label>
                                <input required class="form-control" id="codeword" type="text" name="codeword" th:value="${codeword}"/>
                                <div class="tooltip-info" data-toggle="tooltip" data-placement="bottom" title="Важно! Придумайте и запомните любое слово или комбинацию букв или цифр. Оно потребуется вам при обращениях в банк.">
                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M13.07 9.25L12.17 10.17C11.45 10.89 11 11.5 11 13H9V12.5C9 11.39 9.45 10.39 10.17 9.67L11.41 8.41C11.78 8.05 12 7.55 12 7C12 5.89 11.1 5 10 5C9.46957 5 8.96086 5.21071 8.58579 5.58579C8.21071 5.96086 8 6.46957 8 7H6C6 5.93913 6.42143 4.92172 7.17157 4.17157C7.92172 3.42143 8.93913 3 10 3C11.0609 3 12.0783 3.42143 12.8284 4.17157C13.5786 4.92172 14 5.93913 14 7C14 7.88 13.64 8.67 13.07 9.25ZM11 17H9V15H11V17ZM10 0C8.68678 0 7.38642 0.258658 6.17317 0.761205C4.95991 1.26375 3.85752 2.00035 2.92893 2.92893C1.05357 4.8043 0 7.34784 0 10C0 12.6522 1.05357 15.1957 2.92893 17.0711C3.85752 17.9997 4.95991 18.7362 6.17317 19.2388C7.38642 19.7413 8.68678 20 10 20C12.6522 20 15.1957 18.9464 17.0711 17.0711C18.9464 15.1957 20 12.6522 20 10C20 4.47 15.5 0 10 0Z" fill="#7775D9"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <div th:if="${series}" class="pass-title">Паспортные данные</div>
                        <div class="form-row">

                            <th:block th:if="${series}">
                                <div class="md-form form-group col-md col-12">
                                    <div class="md-form max-width">
                                        <label for="name">Имя</label>
                                        <input required class="form-control" type="text" name="name" id="name" th:value="${name}"/>
                                    </div>
                                    <div class="md-form max-width">
                                        <label for="surname">Фамилия</label>
                                        <input required class="form-control" type="text" name="surname" id="surname" th:value="${surname}"/>
                                    </div>

                                    <div class="md-form max-width">
                                        <label for="patronymic">Отчество</label>
                                        <input required class="form-control" type="text" name="patronymic" id="patronymic" th:value="${patronymic}"/>
                                    </div>


                                    <div class="md-form max-width">
                                        <label for="birthdate">Дата рождения</label>
                                        <input required class="form-control" type="text" name="birthdate" id="birthdate" th:value="${birthdate}"/>
                                    </div>
                                </div>
                            </th:block>

                            <div th:class="${series} ? 'md-form form-group col-md col-12' : 'md-form form-group col-md-12 col-12'">
                                <div th:if="${series}">
                                    <div class="d-flex">
                                        <div class="md-form series max-width">
                                            <label for="series">Серия</label>
                                            <input class="form-control input-disable" id="series" readonly type="text" name="series" th:value="${series}" th:required="${series == null} ? false : true"/>
                                        </div>
                                        <div class="md-form max-width">
                                            <label for="number">Номер</label>
                                            <input class="form-control input-disable" id="number" readonly type="text" name="number" th:value="${number}" th:required="${number == null} ? false : true"/>
                                        </div>
                                    </div>
                                </div>
                                <th:block th:if="${series}">
                                    <div class="upload-warn">Если серия или номер документа распознаны некорректно, вы можете еще раз попробовать загрузить фото паспорта ниже</div>
                                </th:block>

                                <div class="passport-success">
                                    <input name="passportFile" type="file" class="file" id="file" data-browse-on-zone-click="true">
                                    <div class="upload-icon">
                                        <svg width="14" height="17" viewBox="0 0 14 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M4 13V7H0L7 0L14 7H10V13H4ZM0 17V15H14V17H0Z" fill="#78909C"/>
                                        </svg>
                                    </div>
                                    <div class="warning">Убедитесь, что изображение достаточно четкое</div>
                                </div>

                            </div>
                        </div>
                        <div th:class="!${series} ? 'hidden' : 'notify'">
                            <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M16.1732 10.7612C17.3864 10.2587 18.6868 10 20 10C25.5 10 30 14.47 30 20C30 22.6522 28.9464 25.1957 27.0711 27.0711C25.1957 28.9464 22.6522 30 20 30C18.6868 30 17.3864 29.7413 16.1732 29.2388C14.9599 28.7362 13.8575 27.9997 12.9289 27.0711C11.0536 25.1957 10 22.6522 10 20C10 17.3478 11.0536 14.8043 12.9289 12.9289C13.8575 12.0003 14.9599 11.2638 16.1732 10.7612ZM19 14V16H21V14H19ZM21 26V18H19V26H21Z" fill="#F21E50"/>
                            </svg>
                            <span>Прежде чем выпустить карту, проверьте правильность введеных личных данных и откорректируйте их при необходимости (в случае некорректного распознавания)</span>
                        </div>
                    </div>

                </div>

                <div class="text-center" id="errorMessageId" th:class="${errorMessage} ? 'text-center' : 'text-center hidden'">
                    <div>
                        <svg width="55" height="55" viewBox="0 0 55 55" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="27.5" cy="27.5" r="26" stroke="#F21E50" stroke-width="3"/>
                            <path d="M35.5564 20.0001L20 35.5565" stroke="#F21E50" stroke-width="3"/>
                            <path d="M35.5564 35.5564L20 20" stroke="#F21E50" stroke-width="3"/>
                        </svg>

                    </div>
                    <h1 class="error-title" th:text="${errorMessage}" id="errorText"></h1>
                    <div th:class="${fatalError} ? 'hidden' : ''" id="chooseFilelId">
                        <div class="passport-success">
                            <input name="passportFile" type="file" class="file" id="err-file" data-browse-on-zone-click="true">
                            <div class="upload-icon">
                                <svg width="14" height="17" viewBox="0 0 14 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M4 13V7H0L7 0L14 7H10V13H4ZM0 17V15H14V17H0Z" fill="#78909C"/>
                                </svg>
                            </div>
                            <div class="warning">Убедитесь, что изображение достаточно четкое</div>
                        </div>
                    </div>
                </div>

                <div th:class="${okMessage} ? 'text-center' : 'text-center hidden'" id="okMessageId">
                    <div>
                        <svg width="55" height="55" viewBox="0 0 55 55" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="27.5" cy="27.5" r="26" stroke="#1DCE00" stroke-width="3"/>
                            <path d="M40.9176 19.9176L25.3613 35.474L14.4437 24.5563" stroke="#1DCE00" stroke-width="3"/>
                        </svg>

                    </div>
                    <th:block th:if="!${p2pOkMessage}">
                        <h1 class="error-title">Поздравляем!<br/>Ваша карта успешно выпущена.</h1>
                        <div class="passport-success">
                            <div class="warning">Сейчас мы перенаправим Вас на страницу личного кабинета, где вы сможете пополнить её или проверить реквизиты. Если переадресация не произошла, нашмите кнопку "Вернуться на RUNET"</div>
                        </div>
                    </th:block>

                    <th:block th:if="${p2pOkMessage}">
                        <h1 class="error-title" th:text="${p2pOkMessage}"></h1>
                        <div class="passport-success">
                            <div class="refill" th:text="${p2pOkAmount}"></div>
                            <div class="refill" th:text="${p2pOkDateTime}"></div>
                            <div class="refill" th:text="${p2pOkToCardNumber}"></div>
                        </div>
                    </th:block>

                </div>


                <div class="actions">
                    <th:block th:if="!${errorMessage} and !${okMessage}">
                        <button th:class="!${series} ? 'btn btn-submit hidden' : 'btn btn-submit'" id="btn_open_card" value="Данные верны, выпустить карту">Данные верны, выпустить карту</button>
                    </th:block>
                    <button class="btn btn-return" type="button" id="to-runet" name="return_to_runet">НАЗАД</button>
                </div>
            </form>


        </div>
        <div class="logo">
            <svg width="160" height="15" viewBox="0 0 160 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M58.4225 8.28814H65.5296V5.56372H58.4225V2.81868H65.7158V0H55.3795V14.1169H65.7915V11.4102H58.4225V8.28814Z" fill="white"/>
                <path d="M49.7182 8.89488L43.3907 0H40.1062V14.1169H43.0183V4.59176L49.8316 14.1169H52.6128V0H49.7182V8.89488Z" fill="white"/>
                <path d="M22.8285 4.60943C22.8285 1.90563 21.787 0 17.4552 0H10.8193V14.1169H13.7896V9.42504H16.8733L19.416 14.1111H22.6597L19.9309 9.08633C22.2146 8.34411 22.8285 6.55335 22.8285 4.60943ZM17.3708 6.74479H13.7896V2.66846H17.333C19.0611 2.66846 19.7651 3.0867 19.7651 4.73019C19.7651 6.37368 19.0232 6.74479 17.3708 6.74479Z" fill="white"/>
                <path d="M0 8.84194H8.55013L8.57049 6.74487H0V8.84194Z" fill="white"/>
                <path d="M34.5002 8.32643C34.5002 10.4971 33.962 11.6223 31.1982 11.6223C28.4345 11.6223 27.9283 10.4206 27.9283 8.32643V0H24.8678V8.72405C24.8678 11.4308 25.3507 14.382 31.1604 14.382C36.9701 14.382 37.453 11.4367 37.453 8.72405V0H34.5002V8.32643Z" fill="white"/>
                <path d="M141.422 0.253418H136.476V14.3704H141.338C146.757 14.3704 149.076 12.8093 149.076 7.30158C149.085 1.70252 146.839 0.253418 141.422 0.253418ZM141.515 11.6459H139.528V3.05442H141.457C145.393 3.05442 146.024 4.12063 146.024 7.30158C146.024 10.4825 145.262 11.6459 141.515 11.6459Z" fill="white"/>
                <path d="M150.912 6.74487L150.932 8.84194H160V6.74487H150.912Z" fill="white"/>
                <path d="M128.572 6.74487H77.4021V8.84784H128.572V6.74487Z" fill="white"/>
                <path d="M79.5985 0H67.0163V2.81868H71.7844V14.1169H74.8478V2.81868H79.5985V0Z" fill="white"/>
                <path d="M133.535 0.253418H130.509V14.3704H133.535V0.253418Z" fill="white"/>
            </svg>
            <svg width="76" height="34" viewBox="0 0 76 34" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g opacity="0.6">
                    <path d="M8.75294 28.3314V26.843C8.42711 27.3761 7.93097 27.7982 7.2645 28.1093C6.61284 28.4055 5.94637 28.5536 5.2651 28.5536C3.81368 28.5536 2.5696 28.05 1.53288 27.0429C0.510959 26.0358 0 24.7325 0 23.133C0 21.5334 0.510959 20.2375 1.53288 19.2452C2.5696 18.2381 3.81368 17.7346 5.2651 17.7346C5.94637 17.7346 6.61284 17.8827 7.2645 18.1789C7.91616 18.4603 8.4123 18.875 8.75294 19.423V17.9567H11.0189V28.3314H8.75294ZM3.26569 20.8448C2.65847 21.4224 2.35485 22.1777 2.35485 23.1107C2.35485 24.0438 2.65847 24.8139 3.26569 25.4212C3.88773 26.0284 4.64306 26.332 5.53168 26.332C6.42031 26.332 7.17564 26.0432 7.79767 25.4656C8.41971 24.8732 8.73073 24.0882 8.73073 23.1107C8.73073 22.1481 8.4049 21.3853 7.75324 20.8225C7.11639 20.2449 6.37587 19.9561 5.53168 19.9561C4.64306 19.9561 3.88773 20.2523 3.26569 20.8448Z" fill="#F2F2F2"/>
                    <path d="M15.4032 17.9567V19.4896C15.7142 18.9416 16.1882 18.5121 16.825 18.2011C17.4767 17.8901 18.158 17.7346 18.8689 17.7346C20.3055 17.7346 21.5199 18.2381 22.5122 19.2452C23.5193 20.2523 24.0229 21.5557 24.0229 23.1552C24.0229 24.7695 23.5193 26.0728 22.5122 27.0651C21.5199 28.0574 20.3055 28.5536 18.8689 28.5536C18.1283 28.5536 17.4396 28.4055 16.8028 28.1093C16.1808 27.813 15.7142 27.3909 15.4032 26.843V33.3743H13.115V17.9567H15.4032ZM15.4254 23.1996C15.4254 24.1623 15.7364 24.9324 16.3585 25.51C16.9953 26.0728 17.7359 26.3542 18.58 26.3542C19.4687 26.3542 20.2092 26.0654 20.8016 25.4878C21.394 24.8954 21.6902 24.1327 21.6902 23.1996C21.6902 22.2517 21.3866 21.4742 20.7794 20.867C20.187 20.2597 19.4539 19.9561 18.58 19.9561C17.7062 19.9561 16.9583 20.2523 16.3363 20.8448C15.729 21.4372 15.4254 22.2221 15.4254 23.1996Z" fill="#F2F2F2"/>
                    <path d="M27.7428 28.3314V17.9567H25.4768V28.3314H27.7428ZM25.5212 14.7799C25.225 14.4985 25.0769 14.1579 25.0769 13.758C25.0769 13.3581 25.225 13.0175 25.5212 12.7361C25.8322 12.4547 26.1951 12.314 26.6098 12.314C27.0393 12.314 27.3947 12.4547 27.6761 12.7361C27.9723 13.0026 28.1204 13.3433 28.1204 13.758C28.1204 14.1727 27.9723 14.5207 27.6761 14.8021C27.3947 15.0687 27.0393 15.202 26.6098 15.202C26.1951 15.202 25.8322 15.0613 25.5212 14.7799Z" fill="#F2F2F2"/>
                    <path d="M32.4302 23.1107C32.4302 24.0882 32.7338 24.8732 33.341 25.4656C33.9631 26.0432 34.7184 26.332 35.607 26.332C36.4808 26.332 37.2213 26.0284 37.8286 25.4212C38.4358 24.8139 38.7394 24.0438 38.7394 23.1107C38.7394 22.1777 38.4358 21.4224 37.8286 20.8448C37.2362 20.2523 36.4956 19.9561 35.607 19.9561C34.7628 19.9561 34.0223 20.2449 33.3855 20.8225C32.7486 21.3853 32.4302 22.1481 32.4302 23.1107ZM32.408 28.3314H30.1198V12.314H32.408V19.4452C32.719 18.8972 33.1855 18.4751 33.8076 18.1789C34.4444 17.8827 35.1405 17.7346 35.8958 17.7346C37.3472 17.7346 38.5691 18.2307 39.5614 19.223C40.5685 20.2153 41.0721 21.526 41.0721 23.1552C41.0721 24.7399 40.5611 26.0358 39.5392 27.0429C38.5321 28.05 37.3102 28.5536 35.8736 28.5536C35.1479 28.5536 34.4666 28.4055 33.8298 28.1093C33.1929 27.7982 32.719 27.3687 32.408 26.8207V28.3314Z" fill="#F2F2F2"/>
                    <path d="M50.6114 28.3314V26.843C50.2856 27.3761 49.7894 27.7982 49.1229 28.1093C48.4713 28.4055 47.8048 28.5536 47.1235 28.5536C45.6721 28.5536 44.428 28.05 43.3913 27.0429C42.3694 26.0358 41.8584 24.7325 41.8584 23.133C41.8584 21.5334 42.3694 20.2375 43.3913 19.2452C44.428 18.2381 45.6721 17.7346 47.1235 17.7346C47.8048 17.7346 48.4713 17.8827 49.1229 18.1789C49.7746 18.4603 50.2708 18.875 50.6114 19.423V17.9567H52.8774V28.3314H50.6114ZM45.1241 20.8448C44.5169 21.4224 44.2133 22.1777 44.2133 23.1107C44.2133 24.0438 44.5169 24.8139 45.1241 25.4212C45.7462 26.0284 46.5015 26.332 47.3901 26.332C48.2788 26.332 49.0341 26.0432 49.6561 25.4656C50.2782 24.8732 50.5892 24.0882 50.5892 23.1107C50.5892 22.1481 50.2633 21.3853 49.6117 20.8225C48.9748 20.2449 48.2343 19.9561 47.3901 19.9561C46.5015 19.9561 45.7462 20.2523 45.1241 20.8448Z" fill="#F2F2F2"/>
                    <path d="M57.2617 22.7553V28.3314H54.9735V17.9567H57.2617V19.5118C57.5431 18.949 57.9874 18.5121 58.5946 18.2011C59.2018 17.8901 59.8165 17.7346 60.4385 17.7346C61.6974 17.7346 62.6675 18.127 63.3487 18.912C64.0448 19.6969 64.3929 20.8225 64.3929 22.2888V28.3314H62.1047V22.5554C62.1047 21.7408 61.9047 21.1113 61.5048 20.667C61.1198 20.2079 60.594 19.9783 59.9275 19.9783C59.1722 19.9783 58.5354 20.2079 58.017 20.667C57.5134 21.1113 57.2617 21.8074 57.2617 22.7553Z" fill="#F2F2F2"/>
                    <path d="M73.0675 28.3314L68.6466 23.5106V28.3314H66.3806V12.314H68.6466V21.3779L71.9345 17.9567H75.0003L70.5794 22.4665L76 28.3314H73.0675Z" fill="#F2F2F2"/>
                    <path d="M30.7833 2.41139V3.10443C30.9153 2.85759 31.1105 2.66456 31.3687 2.52532C31.627 2.38608 31.8995 2.31646 32.1865 2.31646C32.7489 2.31646 33.2252 2.53165 33.6154 2.96203C34.0057 3.3924 34.2008 3.95253 34.2008 4.64241C34.2008 5.32595 34.0057 5.87975 33.6154 6.3038C33.2309 6.72785 32.7546 6.93987 32.1865 6.93987C31.8938 6.93987 31.6183 6.87658 31.3601 6.75C31.1019 6.61709 30.9096 6.42722 30.7833 6.18038V9H30V2.41139H30.7833ZM30.792 4.6519C30.792 5.10127 30.9239 5.4557 31.1879 5.71519C31.4519 5.96835 31.7589 6.09494 32.109 6.09494C32.482 6.09494 32.7919 5.96203 33.0387 5.6962C33.2855 5.43038 33.4089 5.08228 33.4089 4.6519C33.4089 4.21519 33.2826 3.85759 33.0301 3.57911C32.7833 3.30063 32.4763 3.16139 32.109 3.16139C31.7417 3.16139 31.429 3.29747 31.1707 3.56962C30.9182 3.83544 30.792 4.1962 30.792 4.6519Z" fill="#F2F2F2"/>
                    <path d="M38.5684 6.2943C38.1609 6.72468 37.6645 6.93987 37.0792 6.93987C36.4938 6.93987 35.9974 6.72468 35.59 6.2943C35.1825 5.86392 34.9788 5.3038 34.9788 4.61392C34.9788 3.93038 35.1796 3.37658 35.5814 2.95253C35.9888 2.52848 36.4881 2.31646 37.0792 2.31646C37.6703 2.31646 38.1696 2.52848 38.577 2.95253C38.9845 3.37658 39.1882 3.93038 39.1882 4.61392C39.1882 5.29747 38.9816 5.8576 38.5684 6.2943ZM36.1323 5.6962C36.3905 5.96835 36.7062 6.10443 37.0792 6.10443C37.4522 6.10443 37.765 5.96835 38.0175 5.6962C38.2757 5.41772 38.4048 5.05696 38.4048 4.61392C38.4048 4.17722 38.2757 3.82595 38.0175 3.56013C37.765 3.2943 37.4522 3.16139 37.0792 3.16139C36.7062 3.16139 36.3905 3.2943 36.1323 3.56013C35.8798 3.82595 35.7535 4.17722 35.7535 4.61392C35.7535 5.05696 35.8798 5.41772 36.1323 5.6962Z" fill="#F2F2F2"/>
                    <path d="M44.6313 6.84494H43.9857L42.8924 3.58861L41.8336 6.84494H41.1966L39.6643 2.41139H40.4993L41.5065 5.51582L42.5137 2.41139H43.2712L44.2783 5.51582L45.2855 2.41139H46.1205L44.6313 6.84494Z" fill="#F2F2F2"/>
                    <path d="M47.3883 4.28165H49.8846C49.8387 3.91456 49.7039 3.62658 49.4801 3.41772C49.262 3.20253 48.9894 3.09494 48.6623 3.09494C48.3237 3.09494 48.0367 3.20253 47.8014 3.41772C47.5719 3.62658 47.4342 3.91456 47.3883 4.28165ZM50.6594 4.61392C50.6594 4.77848 50.6565 4.8924 50.6508 4.9557H47.3883C47.4342 5.32278 47.5748 5.61709 47.8101 5.83861C48.0511 6.0538 48.3438 6.16139 48.6881 6.16139C48.9349 6.16139 49.1615 6.10127 49.3681 5.98101C49.5747 5.86076 49.7326 5.69304 49.8416 5.47785C49.9162 5.50949 50.031 5.56013 50.1859 5.62975C50.3409 5.69304 50.4499 5.73734 50.513 5.76266C50.3466 6.14241 50.097 6.43354 49.7641 6.63608C49.4313 6.83861 49.064 6.93987 48.6623 6.93987C48.0769 6.93987 47.5862 6.72468 47.1903 6.2943C46.8 5.86392 46.6049 5.3038 46.6049 4.61392C46.6049 3.92405 46.8 3.37025 47.1903 2.95253C47.5862 2.52848 48.0769 2.31646 48.6623 2.31646C49.2419 2.31646 49.7182 2.52848 50.0912 2.95253C50.47 3.37025 50.6594 3.92405 50.6594 4.61392Z" fill="#F2F2F2"/>
                    <path d="M52.4384 5.23101V6.84494H51.655V2.41139H52.4384V3.40823C52.6335 2.68038 53.0065 2.31646 53.5575 2.31646C53.8731 2.31646 54.1055 2.37342 54.2547 2.48734L54.1342 3.2943C53.9448 3.19304 53.7468 3.1424 53.5402 3.1424C53.173 3.1424 52.8975 3.33544 52.7138 3.72152C52.5302 4.10127 52.4384 4.60443 52.4384 5.23101Z" fill="#F2F2F2"/>
                    <path d="M55.4669 4.28165H57.9632C57.9173 3.91456 57.7825 3.62658 57.5587 3.41772C57.3406 3.20253 57.068 3.09494 56.7409 3.09494C56.4023 3.09494 56.1153 3.20253 55.8801 3.41772C55.6505 3.62658 55.5128 3.91456 55.4669 4.28165ZM58.738 4.61392C58.738 4.77848 58.7351 4.8924 58.7294 4.9557H55.4669C55.5128 5.32278 55.6534 5.61709 55.8887 5.83861C56.1297 6.0538 56.4224 6.16139 56.7667 6.16139C57.0135 6.16139 57.2402 6.10127 57.4467 5.98101C57.6533 5.86076 57.8112 5.69304 57.9202 5.47785C57.9948 5.50949 58.1096 5.56013 58.2645 5.62975C58.4195 5.69304 58.5285 5.73734 58.5916 5.76266C58.4252 6.14241 58.1756 6.43354 57.8427 6.63608C57.5099 6.83861 57.1426 6.93987 56.7409 6.93987C56.1555 6.93987 55.6648 6.72468 55.2689 6.2943C54.8786 5.86392 54.6835 5.3038 54.6835 4.61392C54.6835 3.92405 54.8786 3.37025 55.2689 2.95253C55.6648 2.52848 56.1555 2.31646 56.7409 2.31646C57.3205 2.31646 57.7968 2.52848 58.1698 2.95253C58.5486 3.37025 58.738 3.92405 58.738 4.61392Z" fill="#F2F2F2"/>
                    <path d="M62.9101 6.84494V6.16139C62.7781 6.40823 62.583 6.60127 62.3247 6.74051C62.0665 6.87342 61.791 6.93987 61.4983 6.93987C60.9302 6.93987 60.4481 6.72468 60.0521 6.2943C59.6619 5.86392 59.4668 5.30696 59.4668 4.62342C59.4668 3.93354 59.6619 3.37658 60.0521 2.95253C60.4424 2.52848 60.9216 2.31646 61.4897 2.31646C61.7939 2.31646 62.0722 2.38291 62.3247 2.51582C62.583 2.6424 62.7781 2.82911 62.9101 3.07595V0H63.6934V6.84494H62.9101ZM62.5055 5.6962C62.7695 5.42405 62.9015 5.06329 62.9015 4.61392C62.9015 4.16456 62.7666 3.81013 62.4969 3.55063C62.2272 3.29114 61.9173 3.16139 61.5672 3.16139C61.1999 3.16139 60.89 3.29747 60.6375 3.56962C60.3907 3.83544 60.2674 4.18354 60.2674 4.61392C60.2674 5.0443 60.3907 5.39873 60.6375 5.67722C60.89 5.9557 61.1999 6.09494 61.5672 6.09494C61.9345 6.09494 62.2472 5.96203 62.5055 5.6962Z" fill="#F2F2F2"/>
                    <path d="M68.024 6.16139V6.84494H67.2406V0H68.024V3.07595C68.1559 2.82911 68.3482 2.6424 68.6007 2.51582C68.8532 2.38291 69.1315 2.31646 69.4357 2.31646C70.0096 2.31646 70.4916 2.52848 70.8819 2.95253C71.2721 3.37658 71.4672 3.93354 71.4672 4.62342C71.4672 5.30696 71.2693 5.86392 70.8733 6.2943C70.4773 6.72468 69.9952 6.93987 69.4271 6.93987C69.1402 6.93987 68.8676 6.87342 68.6093 6.74051C68.3511 6.60127 68.1559 6.40823 68.024 6.16139ZM68.0326 4.61392C68.0326 5.06962 68.1617 5.43038 68.4199 5.6962C68.6782 5.96203 68.9938 6.09494 69.3668 6.09494C69.7341 6.09494 70.0411 5.9557 70.2879 5.67722C70.5404 5.39873 70.6667 5.0443 70.6667 4.61392C70.6667 4.18354 70.5404 3.83544 70.2879 3.56962C70.0411 3.29747 69.7341 3.16139 69.3668 3.16139C69.0168 3.16139 68.7069 3.29114 68.4371 3.55063C68.1674 3.81013 68.0326 4.16456 68.0326 4.61392Z" fill="#F2F2F2"/>
                    <path d="M73.5036 9H72.6858L73.5294 6.71203L71.9197 2.41139H72.7547L73.9599 5.62025L75.165 2.41139H76L73.5036 9Z" fill="#F2F2F2"/>
                </g>
            </svg>

        </div>
        <div class="footer">
            Выпуск и обслуживание карт «RUNET-ID PAY» осуществляет <a href="https://creditural.ru">Банк-партнер Банк «КУБ (АО)</a>. Банк «КУБ» (АО) генеральная лицензия ЦБ РФ №2584 от 15.09.15 г. Группа Газпромбанка. Участник Системы обязательного страхования вкладов.
            Заполняя форму, Вы даете свое согласие Банк «КУБ» (АО) и ЦБП (ООО) на <a href="https://apibank.club/privacy">обработку Ваших персональных данных</a>, а также соглашаетесь с
            <a href="http://www.creditural.ru/private/cards/id/">условиями использования предоплаченных банковских карт Банка «КУБ» (АО)</a>. Нажимая кнопку «Данные верны, выпустить карту»‎, Вы даете согласие на отправку
            СМС-оповещений по выпуску и активации карты и исключаете свою принадлежность к публичным должностным лицам (ИПДЛ/РПДЛ), а также наличие связи с публичными должностными лицами (ИПДЛ/РПДЛ).
        </div>
    </div>
</div>

<a class="hidden" th:href="${okMessage} ? ${redirectUrl} : ${startUrl}" id="redirect"></a>

<div th:replace="fragments/footer :: footer"></div>

<script th:if="${waitVPK}">
    $('#spinner').show();
    $('#spinner-title').text("Выпуск виртуальной карты. Процесс может занять до 2 минут");
    $("#form").attr("action", "open-card");
    $("#form").hide();

    getVPK();

    function getVPK() {
        setTimeout(function() {
            $.post('status', function(data) {
                if(data == 'wait')
                    getVPK();
                else {
                    $('#spinner').hide();
                    $("#form").show();
                    $('#formDataId').hide();
                    $('#chooseFilelId').hide();
                    $('#btn_open_card').hide();

                    if(data == 'error') {
                        $('#errorMessageId').removeClass('hidden');
                        $('#errorMessageId').show();
                        $('#errorText').text("Извините, мы не можем выпустить Вам карту.");
                        setTimeout(function() {
                            document.location.href = "[[${startUrl}]]";
                        }, 5000);
                    }else if(data == 'ok') {
                        $('#spinner').hide();
                        $('#okMessageId').removeClass('hidden');
                        $('#okMessageId').show();
                        setTimeout(function() {
                            document.location.href = "[[${redirectUrl}]]";
                        }, 5000);
                    }else {
                        $('#errorMessageId').removeClass('hidden');
                        $('#errorMessageId').show();
                        $('#errorText').text(data);
                        setTimeout(function() {
                            document.location.href = "[[${startUrl}]]";
                        }, 5000);
                    }
                }
            });
        },5000);
    }
</script>

<script th:if="!${waitVPK}">
    $('#spinner').hide();

    $('label[for]').click(function() {$('#'+$(this).attr('for')).focus();});

    $("#phoneNumber").mask("+7 (999) 999-9999");


    $("#phoneNumber").change(function() {
        if(new RegExp("^\\+[^\\7]$").test($("#phoneNumber").val()))
            $("#phoneNumber").val('+7');
    });

    $("#birthdate").mask("99.99.9999");

    $(document).ready(function() {
        //$('#spinner').hide();
        $('.file-drop-zone-title').text('Загрузите фото паспорта (в формате .jpeg, .jpg, .png или .gif)');
        $('[data-toggle="tooltip"]').tooltip();
        window.history.pushState(null, "", window.location.href);
        window.onpopstate = function() {
            window.history.pushState(null, "", window.location.href);
        };

        $("input[type=text]").keydown(function(event){
            if(event.keyCode == 13){
                event.preventDefault();
                return false;
            }
        });

        $(document.body).scrollTop(0);

        $('#to-runet').on('click', function(e) {
            location.href = $('#redirect').attr('href');
        });

    });
</script>

<script th:if="${passportId}">
    $(document).ready(function() {
        $('.form-container').removeClass('height-100');
    });
</script>

<script th:if="${okMessage}">
    $(document).ready(function() {
        $('#spinner').hide();
        setTimeout(function() {
            document.location.href = "[[${redirectUrl}]]";
        }, 5000); // Задержка 5 секунд
    });
</script>

<script th:if="${fatalError}">
    $(document).ready(function() {
        $('#spinner').hide();
        setTimeout(function() {
            document.location.href = "[[${startUrl}]]";
        }, 5000); // Задержка 10 секунд
    });
</script>

<script th:if="${firstPage}">
    //Нажимаем на выбор файла паспорта
    //Здесь нужна проверка только в первый раз
    $("#file").on('click',function(e) {
        if(!validateFields())
            e.preventDefault();
    });
</script>

<script th:if="!${okMessage}">

    $(document).ready(function() {
        // Нажимаем на кнопку выпуска карты
        $('#btn_open_card').on('click',function(e) {
            if(!validateFields())
                e.preventDefault();
            else {
                $('body,html').scrollTop(0);
                $('#spinner').show();
                $('#spinner-title').text("Выпуск виртуальной карты. Процесс может занять до 2 минут");
                $("#form").attr("action", "open-card");
                $("#form").hide();
                $("#form").submit();
            }
        });

        $("#file").change(function (e) {
            startCheckPassport();
        });

        $("#err-file").change(function (e) {
            startCheckPassport();
        });
    });

    function startCheckPassport() {
        $('body,html').scrollTop(0);
        $('#spinner').show();
        $("#form").hide();
        $("#form").submit();
    }




    function createErrorToolTip(id, message) {
        $('#'+id).tooltip({
            html: true,
            title: '<div class="tool-tip-error">'+message+'</div>',
            trigger: 'manual',
            delay: {"show": 0, "hide": 100},
        }).tooltip('show');

        setTimeout(function () {
            $('#'+id).tooltip('hide');
        }, 2000);
    }

    function validateFields() {
        var valid = true;

        if($('#codeword').val() == '') {
            valid = false;
            createErrorToolTip('codeword', 'Задайте кодовое слово.');
        }

        if($('#phoneNumber').val() == '') {
            valid = false;
            createErrorToolTip('codeword', 'Введите номер телефона.');
        }

        var phone = $('#phoneNumber').val().replace(new RegExp('[^\\d]','g'),'');
        var tel = new RegExp('^[\\d]{11}$');
        if(!tel.test(phone)) {
            valid = false;
            createErrorToolTip('phoneNumber', 'Неверный формат номера телефона.');
        }

        if($('#name').val() == '') {
            valid = false;
            createErrorToolTip('name', 'Введите имя.');
        }

        if($('#surname').val() == '') {
            valid = false;
            createErrorToolTip('surname', 'Введите фамилию.');
        }

        if($('#patronymic').val() == '') {
            valid = false;
            createErrorToolTip('patronymic', 'Введите отчество.');
        }

        var date = new RegExp('^([0-9]{2})\\.([0-9]{2})\\.[0-9]{4}$');

        if($('#birthdate').val() != undefined && !date.test($('#birthdate').val())) {
            valid = false;
            createErrorToolTip('birthdate', 'Введите дату в вормате дд.мм.гггг.');
        }

        if(!valid)
            $('.tool-tip-error').parent().css('background','#8e24aa');

        return valid;
    }
</script>

</body>
</html>